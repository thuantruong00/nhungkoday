<!DOCTYPE HTML>
<html>
<head>

</head>
<body>
<div id="chartContainer" style="height: 90vh; width: 100%;"></div>

</body>
</html>
<script src="https://canvasjs.com/assets/script/canvasjs.min.js"></script>


<!-- The core Firebase JS SDK is always required and must be listed first -->
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-app.js"></script>

<!-- TODO: Add SDKs for Firebase products that you want to use
     https://firebase.google.com/docs/web/setup#available-libraries -->
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-analytics.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.6.7/firebase-database.js"></script>
<script>
    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    var firebaseConfig = {
        apiKey: "AIzaSyChZeyXodT_uJiykzmsw201LPVXgk4HFcE",
        authDomain: "lab5-c600f.firebaseapp.com",
        databaseURL: "https://lab5-c600f-default-rtdb.firebaseio.com",
        projectId: "lab5-c600f",
        storageBucket: "lab5-c600f.appspot.com",
        messagingSenderId: "807353309157",
        appId: "1:807353309157:web:000d51ae2688aea3f7810c",
        measurementId: "G-TB967Q3ZRZ"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    // firebase.analytics();

    // Get a reference to the database service
    var database = firebase.database();
    var yyy = 0;
    var xxx = '';
    reData= () =>{
        var starCountRef = firebase.database().ref('/');
        starCountRef.on('value', (snapshot) => {
            const data = snapshot.val();
            reArr = Object.values(data);
            // console.log(reArr);
            // reArr.forEach(element => {
            //     console.log(element['Temp']+' - '+element['Time']);
            // });
            yy = data[1]['Temp'];
            xxx = data[1]['Time'];
            // console.log(xxx);
            yyy = Number(yy);
            

            // console.log(data);
            // updateStarCount(postElement, data);

        });
    }
    




    
   
    var dps = []; // dataPoints
    var chart = new CanvasJS.Chart("chartContainer", {
        title :{
            text: "Temp"
        },
        theme: "light2",
        axisX: {
            title: "Time (s)",
            titleFontSize: 18,
            valueFormatString: "DD MMM,YYYY hh:mm:ss",
            interval: 1
        },
        axisY: {
            title: "Temperature ( °C )",
            titleFontSize: 18,
            suffix: " °C",
            interval: 2
        },
        data: [{
            type: "line",
            dataPoints: dps,
        }]
    });
    
    var xVal = 0;
    var yVal = 30; 
    var updateInterval = 3000;
    var dataLength = 10; // number of dataPoints visible at any point
    // valueFormatString: "DD MM,YYYY hh:mm:ss",
    var updateChart = function (count) {
    
        count = count || 1;
    
        // xVal yVal - get from firebase
        for (var j = 0; j < count; j++) {
            // yVal = yVal +  Math.round(5 + Math.random() *(-5-5));
            // x: new Date('02 13,2020 08:04:20'),
            reData();
            // yVal = Math.floor(Math.random() * 10);

            pp = new Date(xxx);
            console.log(pp);
            xVal = pp;
            yVal = yyy;
            dps.push({
                x: xVal,
                y: yVal
            });
            // xVal++;
        }
    
        if (dps.length > dataLength) {
            dps.shift();
        }
    
        chart.render();
    };
    
    updateChart(dataLength);
    setInterval(function(){updateChart()}, updateInterval);
    

    
    
    
    
    

    </script>
